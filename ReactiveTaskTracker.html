<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dev Threat Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { font-family: sans-serif; }
    .tab-content { margin-top: 1rem; }
    #visual-tabs .nav-link { cursor: pointer; }
    #json-tree, #json-accordion { max-height: 400px; overflow-y: auto; }
  </style>
</head>
<body>
  <div class="container-fluid p-3">
    <!-- Top threat intelligence panel -->
    <div class="bg-dark text-white p-3 mb-3">
      <h5>Threat Intelligence Feed</h5>
      <div id="threat-feed">Loading...</div>
    </div>

    <!-- Navigation tabs -->
    <ul class="nav nav-tabs" id="mainTabs" role="tablist">
      <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#taskTab">Task Tracker</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#threatTab">Threat Feed</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#codeTab">Developer API Config</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#uploadTab">Upload Viewer</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#testTab">Tests</a></li>
    </ul>

    <!-- Tab content -->
    <div class="tab-content">
      <!-- Task Tracker -->
      <div class="tab-pane fade show active" id="taskTab">
        <h4 class="mt-3">Reactive Task Tracker</h4>
        <input type="text" id="taskInput" class="form-control" placeholder="Enter new task..." />
        <button class="btn btn-primary mt-2" onclick="addTask()">Add Task</button>
        <ul id="taskList" class="list-group mt-3"></ul>
      </div>

      <!-- Threat Feed Full Page -->
      <div class="tab-pane fade" id="threatTab">
        <h4 class="mt-3">Full Threat Feed</h4>
        <div id="threat-feed-full">Loading...</div>
      </div>

      <!-- Developer Config -->
      <div class="tab-pane fade" id="codeTab">
        <h4 class="mt-3">Developer Code & API Config</h4>
        <textarea class="form-control" id="codeEditor" rows="10" placeholder="Enter your code or API config..."></textarea>
        <button class="btn btn-success mt-2" onclick="runDeveloperCode()">Run</button>
        <pre id="codeOutput" class="bg-light p-2 mt-2"></pre>
      </div>

      <!-- Upload Viewer -->
      <div class="tab-pane fade" id="uploadTab">
        <h4 class="mt-3">Upload and Visualize JSON/XML</h4>
        <input type="file" id="uploadFile" class="form-control" accept=".json,.xml" onchange="handleFileUpload(event)" />
        <ul class="nav nav-pills mt-3" id="visual-tabs">
          <li class="nav-item"><a class="nav-link active" data-bs-toggle="pill" href="#tree">Tree</a></li>
          <li class="nav-item"><a class="nav-link" data-bs-toggle="pill" href="#accordion">Accordion</a></li>
        </ul>
        <div class="tab-content mt-2">
          <div class="tab-pane fade show active" id="tree"><div id="json-tree"></div></div>
          <div class="tab-pane fade" id="accordion"><div id="json-accordion"></div></div>
        </div>
      </div>

      <!-- Test Tab -->
      <div class="tab-pane fade" id="testTab">
        <h4 class="mt-3">Functionality Tests</h4>
        <button class="btn btn-info" onclick="runTests()">Run Tests</button>
        <ul id="testResults" class="list-group mt-2"></ul>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Threat feed mock fetch
    const threatSummary = 'No current threats detected. Feed updated every 5 minutes.';
    document.getElementById('threat-feed').innerText = 'Fetching threat intelligence...';
    document.getElementById('threat-feed-full').innerText = 'Fetching full threat feed...';
    setTimeout(() => {
      document.getElementById('threat-feed').innerText = threatSummary;
      document.getElementById('threat-feed-full').innerText = threatSummary + '\n\nSample Threat:\n- ID: TH-001\n- Severity: High\n- Description: Suspicious network activity detected.';
    }, 1000);

    // Task Tracker functionality
    function addTask() {
      const input = document.getElementById('taskInput');
      if (!input.value) return;
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between';
      li.innerHTML = `${input.value} <button class='btn btn-sm btn-danger' onclick='this.parentElement.remove()'>Remove</button>`;
      document.getElementById('taskList').appendChild(li);
      input.value = '';
    }

    // Developer code runner (safe mock)
    function runDeveloperCode() {
      const code = document.getElementById('codeEditor').value;
      document.getElementById('codeOutput').innerText = `Code captured:\n${code}`;
    }

    // File Upload handler (basic JSON only for now)
    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const data = JSON.parse(reader.result);
          renderTree(data, 'json-tree');
          renderAccordion(data, 'json-accordion');
        } catch (e) {
          alert('Only JSON parsing is supported currently.');
        }
      };
      reader.readAsText(file);
    }

    // Render JSON Tree view
    function renderTree(obj, containerId, indent = '') {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      function walk(o, space = '') {
        for (let key in o) {
          const item = document.createElement('div');
          item.innerText = `${space}${key}: ${typeof o[key] === 'object' ? '' : o[key]}`;
          container.appendChild(item);
          if (typeof o[key] === 'object') walk(o[key], space + '  ');
        }
      }
      walk(obj);
    }

    // Render Accordion
    function renderAccordion(obj, containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      let idx = 0;
      function createItem(key, value) {
        const id = `acc${idx++}`;
        return `
          <div class="accordion-item">
            <h2 class="accordion-header" id="h${id}">
              <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#c${id}">
                ${key}
              </button>
            </h2>
            <div id="c${id}" class="accordion-collapse collapse">
              <div class="accordion-body">${typeof value === 'object' ? JSON.stringify(value, null, 2) : value}</div>
            </div>
          </div>`;
      }
      let html = '<div class="accordion" id="jsonAccordion">';
      for (let key in obj) {
        html += createItem(key, obj[key]);
      }
      html += '</div>';
      container.innerHTML = html;
    }

    // Test runner
    function runTests() {
      const results = document.getElementById('testResults');
      results.innerHTML = '';
      const tests = [
        { name: 'Task tracker input exists', passed: !!document.getElementById('taskInput') },
        { name: 'Threat feed panel rendered', passed: !!document.getElementById('threat-feed') },
        { name: 'Threat tab content rendered', passed: !!document.getElementById('threat-feed-full') },
        { name: 'Code editor available', passed: !!document.getElementById('codeEditor') },
        { name: 'Upload file input present', passed: !!document.getElementById('uploadFile') }
      ];
      tests.forEach(test => {
        const li = document.createElement('li');
        li.className = `list-group-item ${test.passed ? 'list-group-item-success' : 'list-group-item-danger'}`;
        li.innerText = `${test.name}: ${test.passed ? 'Passed' : 'Failed'}`;
        results.appendChild(li);
      });
    }
  </script>
</body>
</html>
