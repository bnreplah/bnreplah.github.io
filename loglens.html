<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>LogLens â€” Security Log Analyzer</title>
<meta name="description" content="Interactive security log analyzer. Zero dependencies. Supports JSON, Apache, Syslog, CEF, and custom regex."/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg0:#07090d;--bg1:#0d1117;--bg2:#161b22;--bg3:#1e242e;
  --border:#1e242e;--border2:#2d3542;
  --t0:#f0f6fc;--t1:#c9d1d9;--t2:#8b949e;--t3:#4a5568;
  --blue:#4a9eff;--blue-d:#1a5fb4;--blue-glow:#4a9eff22;
  --green:#3fb950;--yellow:#e3b341;--orange:#f0883e;
  --red:#f85149;--purple:#bc8cff;--cyan:#56d4dd;--pink:#f778ba;
  --mono:'Courier New',Courier,monospace;
  --head:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  --radius:6px;
}
html,body{height:100%;overflow:hidden;background:var(--bg0);color:var(--t1);font-family:var(--mono);font-size:13px;line-height:1.5}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--t3)}

/* App shell */
#app{display:flex;flex-direction:column;height:100vh}
#header{display:flex;align-items:center;gap:14px;padding:0 18px;background:var(â€“bg1);border-bottom:1px solid var(â€“border);flex-shrink:0;min-height:52px}
#body-wrap{display:flex;flex:1;overflow:hidden}

/* Logo */
#logomark{width:28px;height:28px;border-radius:6px;background:linear-gradient(135deg,var(â€“blue-d),var(â€“green));display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:900;color:#fff;font-family:var(â€“head);flex-shrink:0;user-select:none}
#logotitle{font-family:var(â€“head);font-weight:800;font-size:15px;color:var(â€“t0);letter-spacing:-.3px;line-height:1}
#logoversion{font-size:9px;color:var(â€“t3);letter-spacing:1.5px;text-transform:uppercase;line-height:1;margin-top:2px}

/* Tab nav */
.tabnav{display:flex}
.tablink{padding:12px 16px;font-family:var(â€“mono);font-size:11px;font-weight:500;color:var(â€“t2);background:none;border:none;cursor:pointer;border-bottom:2px solid transparent;transition:color .13s,border-color .13s;white-space:nowrap;letter-spacing:.3px}
.tablink:hover{color:var(â€“t0)}
.tablink.active{color:var(â€“blue);border-bottom-color:var(â€“blue)}

/* Header right */
#hdr-right{display:flex;align-items:center;gap:10px;margin-left:auto}
#parser-badge{font-size:9px;background:var(â€“bg2);border:1px solid var(â€“border2);border-radius:4px;padding:3px 8px;color:var(â€“t3);letter-spacing:.5px;display:none}
#entry-count{font-size:11px;color:var(â€“t3);display:none}
#entry-count b{color:var(â€“green);font-weight:600;font-style:normal}

/* Buttons */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:5px;cursor:pointer;border:none;border-radius:var(â€“radius);font-family:var(â€“mono);font-size:11px;font-weight:600;padding:6px 13px;transition:all .12s;white-space:nowrap;letter-spacing:.2px;line-height:1.4}
.btn:hover{filter:brightness(1.18)}
.btn:active{transform:scale(.97)}
.btn-p{background:var(â€“blue-d);color:#fff;border:1px solid #2569c7;box-shadow:0 0 14px var(â€“blue-glow)}
.btn-p:hover{background:#2569c7}
.btn-g{background:var(â€“bg2);color:var(â€“t2);border:1px solid var(â€“border2)}
.btn-g:hover{color:var(â€“t0);border-color:var(â€“t3);background:var(â€“bg3)}
.btn-a{background:var(â€“blue-d);color:#fff;border:1px solid var(â€“blue)}
.btn-sm{padding:4px 10px;font-size:10px}

/* Inputs */
.inp{width:100%;background:var(â€“bg1);border:1px solid var(â€“border2);border-radius:var(â€“radius);padding:8px 11px;color:var(â€“t0);font-family:var(â€“mono);font-size:12px;outline:none;transition:border-color .13s}
.inp:focus{border-color:var(â€“blue-d)}
.inp::placeholder{color:var(â€“t3)}
textarea.inp{resize:vertical;line-height:1.7;min-height:320px}
.field-label{display:block;font-size:10px;color:var(â€“t3);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:5px;font-weight:600}

/* Input tab */
#tab-input{flex:1;overflow-y:auto;padding:24px;display:flex;flex-direction:column}
.input-wrap{max-width:840px;margin:0 auto;display:flex;flex-direction:column;gap:18px;width:100%}

/* Parser btns */
#parser-btns{display:flex;gap:7px;flex-wrap:wrap}

/* Custom panel */
#custom-panel{background:var(â€“bg2);border:1px solid var(â€“border2);border-radius:var(â€“radius);padding:14px;flex-direction:column;gap:10px;display:none}

/* Samples bar */
.samples-bar{display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.sep{color:var(â€“border2)}

/* Error */
.err-box{padding:10px 13px;background:#f8514912;border:1px solid #f8514930;border-radius:var(â€“radius);color:var(â€“red);font-size:12px;display:none}

/* Analyze tab */
#tab-analyze{flex:1;display:none;overflow:hidden;flex-direction:row}

/* Sidebar */
.sidebar{width:210px;background:var(â€“bg1);border-right:1px solid var(â€“border);display:flex;flex-direction:column;flex-shrink:0;overflow:hidden}
.sidebar-body{flex:1;overflow-y:auto;overflow-x:hidden}
.sidebar-foot{padding:10px;border-top:1px solid var(â€“border)}
.slabel{font-size:9px;color:var(â€“t3);text-transform:uppercase;letter-spacing:2px;font-weight:600}
.fitem{display:flex;align-items:center;justify-content:space-between;padding:5px 12px;cursor:pointer;border-radius:4px;margin:1px 5px;transition:background .1s,opacity .12s;user-select:none}
.fitem:hover{background:var(â€“bg2)}
.fitem.off{opacity:.25}
.fdot{width:7px;height:7px;border-radius:2px;flex-shrink:0}
.fcount{font-size:10px;color:var(â€“t3)}
.fall{font-size:9px;color:var(â€“t3);cursor:pointer;background:none;border:none;font-family:var(â€“mono);padding:0;margin:0}
.fall:hover{color:var(â€“blue)}
.filter-row{display:flex;align-items:center;justify-content:space-between;padding:12px 12px 6px}

/* Center column */
#center-col{flex:1;display:flex;flex-direction:column;overflow:hidden}

/* Toolbar */
#toolbar{display:flex;align-items:center;gap:8px;padding:8px 14px;border-bottom:1px solid var(â€“border);background:var(â€“bg1);flex-shrink:0}
#search-wrap{display:flex;border:1px solid var(â€“border2);border-radius:var(â€“radius);overflow:hidden;flex:1;max-width:420px}
#srch-mode{padding:6px 10px;background:var(â€“bg2);border:none;border-right:1px solid var(â€“border2);cursor:pointer;color:var(â€“t3);font-size:11px;font-weight:700;font-family:var(â€“mono);flex-shrink:0;transition:color .12s}
#srch-mode:hover,#srch-mode.regex{color:var(â€“blue)}
#srch-inp{flex:1;background:var(â€“bg1);border:none;padding:6px 10px;color:var(â€“t0);font-family:var(â€“mono);font-size:11px;outline:none;min-width:0}
#srch-inp::placeholder{color:var(â€“t3)}
#srch-clear{padding:6px 8px;background:none;border:none;cursor:pointer;color:var(â€“t3);font-size:15px;line-height:1;display:none}
.view-btns{display:flex;gap:4px;margin-left:auto}

/* Stream */
#stream-view{flex:1;overflow-y:auto;overflow-x:hidden;background:var(â€“bg0)}
#stream-empty{display:none;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;color:var(â€“t3);gap:12px;text-align:center}
.empty-icon{font-size:36px;opacity:.3}
.lrow{display:flex;gap:10px;align-items:flex-start;padding:5px 14px;border-bottom:1px solid #0a0c10;cursor:pointer;border-left:2px solid transparent;transition:background .07s}
.lrow:hover{background:var(â€“bg2)}
.lrow.sel{background:var(â€“bg2);border-left-color:var(â€“blue)}
.pill{display:inline-flex;align-items:center;justify-content:center;border-radius:3px;padding:1px 6px;font-size:10px;font-weight:700;letter-spacing:.8px;line-height:1.6;white-space:nowrap;font-family:var(â€“mono)}
.lts{font-size:10px;color:var(â€“t3);white-space:nowrap;flex-shrink:0;margin-top:2px;min-width:145px}
.lsrc{font-size:10px;color:var(â€“cyan);flex-shrink:0;min-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-top:2px}
.lmsg{font-size:12px;color:var(â€“t0);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1}
mark{background:#e3b34120;color:var(â€“yellow);border-radius:2px;padding:0 1px}

/* Dist view */
#dist-view{flex:1;overflow-y:auto;padding:18px;display:none;flex-direction:column;gap:16px}
.stat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.stat-card{background:var(â€“bg1);border:1px solid var(â€“border);border-radius:8px;padding:14px 16px;border-top-width:2px}
.stat-num{font-family:var(â€“head);font-size:26px;font-weight:800;line-height:1;letter-spacing:-.5px}
.stat-lbl{font-size:9px;color:var(â€“t3);text-transform:uppercase;letter-spacing:1.5px;margin-top:4px}
.stat-sub{font-size:10px;color:var(â€“t3);margin-top:2px}
.chart-row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.card{background:var(â€“bg1);border:1px solid var(â€“border);border-radius:8px;padding:16px}
.card-title{font-size:10px;color:var(â€“t3);text-transform:uppercase;letter-spacing:2px;margin-bottom:14px;font-weight:600}
.bar-label{font-family:var(â€“mono);font-size:10px;fill:var(â€“t3)}
.bar-val{font-family:var(â€“mono);font-size:10px;fill:var(â€“t2)}
.src-row{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.src-name{font-size:11px;color:var(â€“t2);width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:0}
.src-bar-bg{flex:1;height:6px;background:var(â€“bg2);border-radius:3px;overflow:hidden}
.src-bar-fill{height:100%;border-radius:3px}
.src-cnt{font-size:10px;color:var(â€“t3);width:36px;text-align:right;flex-shrink:0}
.rank-num{font-size:10px;color:var(â€“t3);width:22px;text-align:right;flex-shrink:0}
.pie-legend{display:flex;flex-direction:column;gap:6px;margin-top:4px}
.pie-li{display:flex;align-items:center;gap:8px;font-size:11px;color:var(â€“t2)}
.pie-dot{width:8px;height:8px;border-radius:2px;flex-shrink:0}

/* Fields view */
#fields-view{flex:1;overflow:auto;display:none}
.ftable{width:100%;border-collapse:collapse;font-size:11px}
.ftable th{padding:7px 12px;text-align:left;color:var(â€“t3);font-weight:600;border-bottom:1px solid var(â€“border);position:sticky;top:0;background:var(â€“bg2);white-space:nowrap;font-size:10px;text-transform:uppercase;letter-spacing:.8px}
.ftable td{padding:5px 12px;border-bottom:1px solid #0a0c10;max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.ftable tr:hover td{background:var(â€“bg2)}
.td-id{color:var(â€“t3)}
.td-src{color:var(â€“cyan)}
.td-ts{color:var(â€“t3);font-size:10px}
.td-msg{color:var(â€“t0);max-width:350px}
.td-f{color:var(â€“blue)}

/* Detail panel */
#detail-panel{width:320px;background:var(â€“bg1);border-left:1px solid var(â€“border);display:none;flex-direction:column;flex-shrink:0;overflow:hidden}
#detail-hdr{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid var(â€“border);flex-shrink:0}
#detail-ttl{font-size:10px;color:var(â€“t3);text-transform:uppercase;letter-spacing:2px}
#detail-close{background:none;border:none;color:var(â€“t3);cursor:pointer;font-size:20px;line-height:1;padding:0 2px}
#detail-close:hover{color:var(â€“t0)}
#detail-body{flex:1;overflow-y:auto;padding:14px}
.dfield{margin-bottom:13px}
.dlabel{font-size:9px;color:var(â€“t3);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:4px;font-weight:600;display:block}
.dval{font-size:12px;color:var(â€“t0);word-break:break-all;line-height:1.6}
.dkv{display:flex;gap:8px;margin-bottom:5px;font-size:11px}
.dkv-k{color:var(â€“blue);min-width:90px;flex-shrink:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.dkv-v{color:var(â€“t1);word-break:break-all;flex:1}
pre.raw-block{background:var(â€“bg0);border:1px solid var(â€“border);border-radius:5px;padding:10px;font-size:10px;line-height:1.6;overflow-x:auto;white-space:pre-wrap;word-break:break-all;color:var(â€“t2)}

/* Scan bar */
#scan-bar{position:fixed;top:0;left:-60%;width:60%;height:2px;background:linear-gradient(90deg,transparent,var(â€“blue),transparent);pointer-events:none;z-index:100;opacity:0}
#scan-bar.run{opacity:1;animation:scanAnim 600ms ease-in-out forwards}
@keyframes scanAnim{0%{left:-60%}100%{left:110%}}

/* Fade */
.fade-in{animation:fadeUp .2s ease both}
@keyframes fadeUp{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}

/* Empty */
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;flex:1;color:var(â€“t3);text-align:center;padding:40px}

/* Responsive */
@media(max-width:900px){.sidebar,.detail-panel{display:none!important}.stat-grid{grid-template-columns:1fr 1fr}.chart-row{grid-template-columns:1fr}}
@media(max-width:600px){.stat-grid{grid-template-columns:1fr}#tab-input{padding:14px}}
</style>

</head>
<body>
<div id="scan-bar"></div>
<div id="app">

  <!-- HEADER -->

  <header id="header">
    <div style="display:flex;align-items:center;gap:10px;padding:12px 0">
      <div id="logomark">âŒ–</div>
      <div>
        <div id="logotitle">LogLens</div>
        <div id="logoversion">Security Log Analyzer Â· v1.0</div>
      </div>
    </div>
    <nav class="tabnav">
      <button class="tablink active" data-tab="input"   onclick="switchTab('input')">â¬† Input</button>
      <button class="tablink"        data-tab="analyze" onclick="switchTab('analyze')">âŠ Analyze</button>
    </nav>
    <div id="hdr-right">
      <span id="parser-badge"></span>
      <span id="entry-count"></span>
      <button class="btn btn-g btn-sm" id="btn-csv"  style="display:none" onclick="exportCSV()">â†“ CSV</button>
      <button class="btn btn-g btn-sm" id="btn-json" style="display:none" onclick="exportJSON()">â†“ JSON</button>
    </div>
  </header>

  <!-- BODY -->

  <div id="body-wrap">

```
<!-- â•â• INPUT TAB â•â• -->
<div id="tab-input">
  <div class="input-wrap">
    <div>
      <label class="field-label">Parser Engine</label>
      <div id="parser-btns"></div>
    </div>
    <div id="custom-panel">
      <label class="field-label">Regex Pattern</label>
      <input class="inp" id="cust-pat" spellcheck="false"/>
      <label class="field-label" style="margin-top:6px">Capture group names <span style="color:var(--t3);text-transform:none;letter-spacing:0">(ordered, comma-separated)</span></label>
      <input class="inp" id="cust-grp" spellcheck="false"/>
      <div style="font-size:10px;color:var(--t3);line-height:1.7;margin-top:2px">
        Recognized: <code style="background:var(--bg3);border:1px solid var(--border2);border-radius:3px;padding:1px 5px;color:var(--blue);font-size:10px">timestamp ts time level severity message msg source service host</code>
      </div>
    </div>
    <div class="samples-bar">
      <span style="font-size:10px;color:var(--t3);text-transform:uppercase;letter-spacing:1px">Samples:</span>
      <button class="btn btn-g btn-sm" onclick="loadSample('json')">JSON Security</button>
      <button class="btn btn-g btn-sm" onclick="loadSample('apache')">Apache Access</button>
      <button class="btn btn-g btn-sm" onclick="loadSample('syslog')">Syslog</button>
      <span class="sep">|</span>
      <button class="btn btn-g btn-sm" onclick="document.getElementById('file-inp').click()">ğŸ“ Load File</button>
      <input type="file" id="file-inp" accept=".log,.txt,.json,.csv" style="display:none" onchange="loadFile(this)"/>
      <button class="btn btn-g btn-sm" id="clear-btn" style="display:none;color:var(--t3)" onclick="clearLog()">âœ• Clear</button>
    </div>
    <textarea class="inp" id="log-inp" rows="18"
      placeholder="Paste log data hereâ€¦
```

Supported formats:
â€¢ JSON / NDJSON        â€“ structured application logs
â€¢ Apache / Nginx       â€“ combined access log format
â€¢ Syslog               â€“ RFC 3164 / RFC 5424
â€¢ CEF / LEEF           â€“ ArcSight, QRadar events
â€¢ Custom Regex         â€“ define your own capture groups

Or click a sample above to get started â†’â€
spellcheck=â€œfalseâ€ oninput=â€œonLogInput(this.value)â€></textarea>
<div class="err-box" id="err-box"></div>
<div style="display:flex;align-items:center;gap:12px">
<button class="btn btn-p" onclick="parseLog()" style="font-size:13px;padding:10px 26px">âŠ Parse & Analyze</button>
<span id="line-count" style="font-size:10px;color:var(--t3)"></span>
</div>
</div>
</div>

```
<!-- â•â• ANALYZE TAB â•â• -->
<div id="tab-analyze">

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-body">
      <div class="filter-row">
        <span class="slabel">Severity</span>
        <button class="fall" onclick="resetLevelFilter()">all</button>
      </div>
      <div id="level-filters"></div>
      <div class="filter-row" style="margin-top:4px">
        <span class="slabel">Sources</span>
        <button class="fall" onclick="resetSourceFilter()">all</button>
      </div>
      <div id="source-filters"></div>
    </div>
    <div class="sidebar-foot">
      <button class="btn btn-g" style="width:100%;font-size:10px" onclick="switchTab('input')">â† Back to Input</button>
    </div>
  </aside>

  <!-- Center -->
  <div id="center-col">
    <div id="toolbar">
      <div id="search-wrap">
        <button id="srch-mode" onclick="toggleSearchMode()" title="Toggle regex mode">Aa</button>
        <input  id="srch-inp"  placeholder="Full-text searchâ€¦" oninput="onSearch(this.value)"/>
        <button id="srch-clear" onclick="clearSearch()">Ã—</button>
      </div>
      <div class="view-btns">
        <button class="btn btn-a btn-sm" id="vbtn-stream" onclick="setView('stream')">â‰¡ Stream</button>
        <button class="btn btn-g btn-sm" id="vbtn-dist"   onclick="setView('dist')">â—ˆ Dist</button>
        <button class="btn btn-g btn-sm" id="vbtn-fields" onclick="setView('fields')">âŠŸ Fields</button>
      </div>
    </div>

    <!-- Stream -->
    <div id="stream-view">
      <div id="stream-list"></div>
      <div id="stream-empty">
        <div class="empty-icon">â—Œ</div>
        <div>No entries match current filters</div>
      </div>
    </div>

    <!-- Dist -->
    <div id="dist-view"></div>

    <!-- Fields -->
    <div id="fields-view">
      <table class="ftable">
        <thead id="fthead"></thead>
        <tbody id="ftbody"></tbody>
      </table>
    </div>
  </div>

  <!-- Detail panel -->
  <div id="detail-panel">
    <div id="detail-hdr">
      <span id="detail-ttl">Entry Detail</span>
      <button id="detail-close" onclick="closeDetail()">Ã—</button>
    </div>
    <div id="detail-body"></div>
  </div>

</div><!-- /tab-analyze -->
```

  </div><!-- /body-wrap -->
</div><!-- /app -->

<script>
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const S = {
  raw: '', entries: [], filtered: [],
  parserId: 'auto', parserUsed: null,
  custPat: String.raw`(?<level>\w+)\s+\[(?<timestamp>[^\]]+)\]\s+(?<source>\S+)\s+(?<message>.+)`,
  custGrp: 'level,timestamp,source,message',
  levelFilter: new Set(), sourceFilter: new Set(),
  search: '', searchMode: 'text',
  view: 'stream', selId: null,
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LEVEL CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LV = {
  CRITICAL:{color:'#f778ba',rank:0}, ERROR:{color:'#f85149',rank:1},
  WARN:{color:'#f0883e',rank:2},     WARNING:{color:'#f0883e',rank:2},
  INFO:{color:'#3fb950',rank:3},     NOTICE:{color:'#56d4dd',rank:3},
  DEBUG:{color:'#4a9eff',rank:4},    TRACE:{color:'#8b949e',rank:5},
};
const COLORS = ['#4a9eff','#3fb950','#f0883e','#f85149','#bc8cff','#56d4dd','#f778ba','#e3b341'];

function normLv(l){ if(!l)return'INFO'; const u=l.toUpperCase(); if(u==='WARNING')return'WARN'; return LV[u]?u:'INFO'; }
function lvMeta(l){ return LV[normLv(l)]||LV.INFO; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARSERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PARSERS = [
  {
    id:'json', badge:'{}', name:'JSON / NDJSON',
    detect(r){ const t=r.trimStart(); return t.startsWith('{')||(t.startsWith('[')&&t.includes('"')); },
    parse(raw){
      return raw.split(/\r?\n/).filter(l=>l.trim()).flatMap((line,i)=>{
        try{
          const o=JSON.parse(line);
          return [{id:i,raw:line,
            level:normLv(o.level||o.severity||o.loglevel||'INFO'),
            timestamp:o.timestamp||o.time||o.ts||o['@timestamp']||o.datetime||'',
            message:o.message||o.msg||o.text||o.event||JSON.stringify(o).slice(0,200),
            source:o.service||o.logger||o.source||o.app||o.component||'unknown',
            fields:o}];
        }catch(e){return[];}
      });
    }
  },
  {
    id:'apache', badge:'//', name:'Apache / Nginx',
    detect(r){ return /\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}.*\[.*\].*"(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)/.test(r); },
    parse(raw){
      const RE=/^(\S+)\s+\S+\s+(\S+)\s+\[([^\]]+)\]\s+"(\S+)\s+(\S+)\s+[^"]+"\s+(\d+)\s+(\S+)(?:\s+"([^"]*)")?(?:\s+"([^"]*)")?/;
      return raw.split(/\r?\n/).filter(Boolean).map((line,i)=>{
        const m=RE.exec(line);
        if(!m)return{id:i,raw:line,level:'INFO',timestamp:'',message:line,source:'apache',fields:{}};
        const st=parseInt(m[6]);
        return{id:i,raw:line,level:st>=500?'ERROR':st>=400?'WARN':'INFO',
          timestamp:m[3],message:`${m[4]} ${m[5]} â†’ ${m[6]}`,source:m[1],
          fields:{ip:m[1],user:m[2],ts:m[3],method:m[4],path:m[5],status:st,bytes:m[7]||'',referer:m[8]||'',ua:m[9]||''}};
      });
    }
  },
  {
    id:'syslog', badge:'SYS', name:'Syslog',
    detect(r){ return /^(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s+\d/.test(r)||/^<\d+>/.test(r); },
    parse(raw){
      const RE=/^(?:<\d+>)?(\w{3}\s+\d+\s+[\d:]+)\s+(\S+)\s+(\S+?)(?:\[\d+\])?:\s*(.*)/;
      return raw.split(/\r?\n/).filter(Boolean).map((line,i)=>{
        const m=RE.exec(line);
        if(!m)return{id:i,raw:line,level:'INFO',timestamp:'',message:line,source:'syslog',fields:{}};
        const msg=m[4];
        const lv=/crit|emerg|alert|error/i.test(msg)?'ERROR':/warn/i.test(msg)?'WARN':/debug/i.test(msg)?'DEBUG':'INFO';
        return{id:i,raw:line,level:lv,timestamp:m[1],message:msg,source:m[3]||'syslog',
          fields:{timestamp:m[1],host:m[2],process:m[3]}};
      });
    }
  },
  {
    id:'cef', badge:'CEF', name:'CEF / LEEF',
    detect(r){ return r.includes('CEF:')||r.includes('LEEF:'); },
    parse(raw){
      const RE=/CEF:\d+\|([^|]*)\|([^|]*)\|([^|]*)\|([^|]*)\|([^|]*)\|(\d+)\|(.*)/;
      return raw.split(/\r?\n/).filter(Boolean).map((line,i)=>{
        const m=RE.exec(line);
        if(!m)return{id:i,raw:line,level:'INFO',timestamp:'',message:line,source:'cef',fields:{}};
        const sev=parseInt(m[6]);
        const ext={};
        m[7].split(/\s(?=\w+=)/).forEach(kv=>{const eq=kv.indexOf('=');if(eq>0)ext[kv.slice(0,eq)]=kv.slice(eq+1);});
        return{id:i,raw:line,level:sev>=8?'ERROR':sev>=5?'WARN':'INFO',
          timestamp:ext.rt||ext.start||'',message:m[5],source:m[2]||'cef',
          fields:{vendor:m[1],product:m[2],version:m[3],sigId:m[4],name:m[5],severity:m[6],...ext}};
      });
    }
  },
  {
    id:'custom', badge:'.*', name:'Custom Regex',
    detect(){ return false; },
    parse(raw,opts={}){
      if(!opts.pattern)return[];
      let re;
      try{re=new RegExp(opts.pattern,'g');}catch(e){throw new Error('Invalid regex: '+e.message);}
      const gnames=(opts.groups||'').split(',').map(s=>s.trim()).filter(Boolean);
      return raw.split(/\r?\n/).filter(Boolean).map((line,i)=>{
        re.lastIndex=0;
        const m=re.exec(line);
        if(!m)return null;
        const f={};
        if(m.groups)Object.assign(f,m.groups);
        gnames.forEach((g,idx)=>{if(f[g]==null)f[g]=m[idx+1]||'';});
        return{id:i,raw:line,
          level:normLv(f.level||f.severity||'INFO'),
          timestamp:f.timestamp||f.ts||f.time||'',
          message:f.message||f.msg||line,
          source:f.source||f.service||f.host||'custom',
          fields:f};
      }).filter(Boolean);
    }
  },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SAMPLE DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SAMPLES = {
  json:`{"timestamp":"2024-03-15T10:00:01.123Z","level":"INFO","service":"auth","message":"User login successful","user_id":"u-4821","ip":"192.168.1.45"}
{"timestamp":"2024-03-15T10:00:03.441Z","level":"WARN","service":"auth","message":"Failed login attempt â€” invalid password","user_id":"u-9912","ip":"45.33.32.156","attempts":3}
{"timestamp":"2024-03-15T10:00:05.882Z","level":"ERROR","service":"database","message":"Connection pool exhausted","pool_size":20,"active":20,"waiting":47}
{"timestamp":"2024-03-15T10:00:07.012Z","level":"INFO","service":"api-gateway","message":"Request routed","path":"/api/v2/users","method":"GET","latency_ms":12,"status":200}
{"timestamp":"2024-03-15T10:00:09.333Z","level":"ERROR","service":"auth","message":"JWT signature verification failed","ip":"198.51.100.23","token_issuer":"unknown","alg":"none"}
{"timestamp":"2024-03-15T10:00:11.009Z","level":"DEBUG","service":"cache","message":"Cache miss","key":"user:4821:profile","ttl":300}
{"timestamp":"2024-03-15T10:00:13.771Z","level":"WARN","service":"rate-limiter","message":"Rate limit threshold approaching","ip":"45.33.32.156","requests_per_min":95,"limit":100}
{"timestamp":"2024-03-15T10:00:15.500Z","level":"ERROR","service":"payment","message":"Transaction declined â€” card verification failed","user_id":"u-2201","amount":299.99,"currency":"USD"}
{"timestamp":"2024-03-15T10:00:17.200Z","level":"INFO","service":"api-gateway","message":"Request routed","path":"/api/v2/products","method":"GET","latency_ms":8,"status":200}
{"timestamp":"2024-03-15T10:00:19.641Z","level":"CRITICAL","service":"auth","message":"SQL injection attempt blocked","ip":"198.51.100.23","payload":"' OR 1=1--","rule":"SQLI-001","blocked":true}
{"timestamp":"2024-03-15T10:00:21.102Z","level":"WARN","service":"filesystem","message":"Disk usage at 85%","path":"/var/log","used_gb":170,"total_gb":200}
{"timestamp":"2024-03-15T10:00:23.887Z","level":"INFO","service":"scheduler","message":"Nightly cleanup completed","deleted_records":1204,"duration_ms":892}
{"timestamp":"2024-03-15T10:00:25.001Z","level":"ERROR","service":"api-gateway","message":"Upstream service timeout","upstream":"user-service","timeout_ms":5000}
{"timestamp":"2024-03-15T10:00:27.330Z","level":"INFO","service":"auth","message":"Password reset email sent","user_id":"u-3301"}
{"timestamp":"2024-03-15T10:00:29.774Z","level":"WARN","service":"security-scanner","message":"Anomalous traffic pattern detected","source_ip":"198.51.100.23","requests_1m":450,"threshold":100}`,

  apache:`192.168.1.10 - frank [15/Mar/2024:10:00:01 -0700] "GET /index.html HTTP/1.1" 200 2326 "-" "Mozilla/5.0"
45.33.32.156 - - [15/Mar/2024:10:00:02 -0700] "POST /api/login HTTP/1.1" 401 512 "-" "python-requests/2.28.0"
10.0.0.5 - admin [15/Mar/2024:10:00:03 -0700] "GET /admin/users HTTP/1.1" 403 256 "https://internal.corp" "Mozilla/5.0"
198.51.100.23 - - [15/Mar/2024:10:00:04 -0700] "GET /etc/passwd HTTP/1.1" 404 196 "-" "curl/7.68.0"
192.168.1.22 - john [15/Mar/2024:10:00:05 -0700] "POST /api/purchase HTTP/1.1" 200 1024 "/products/cart" "Mozilla/5.0"
45.33.32.156 - - [15/Mar/2024:10:00:06 -0700] "GET /wp-admin HTTP/1.1" 404 196 "-" "Googlebot/2.1"
192.168.1.10 - frank [15/Mar/2024:10:00:07 -0700] "GET /dashboard HTTP/1.1" 200 8192 "/" "Mozilla/5.0"
198.51.100.23 - - [15/Mar/2024:10:00:08 -0700] "GET /.env HTTP/1.1" 403 128 "-" "curl/7.68.0"
10.0.0.1 - - [15/Mar/2024:10:00:09 -0700] "GET /health HTTP/1.1" 200 64 "-" "kube-probe/1.26"
45.33.32.156 - - [15/Mar/2024:10:00:10 -0700] "POST /api/login HTTP/1.1" 500 256 "-" "python-requests/2.28.0"
192.168.1.45 - alice [15/Mar/2024:10:00:11 -0700] "GET /api/v2/users HTTP/1.1" 200 4096 "/app" "Mozilla/5.0"
198.51.100.23 - - [15/Mar/2024:10:00:12 -0700] "GET /server-status HTTP/1.1" 403 192 "-" "Nmap Scripting Engine"
192.168.1.22 - john [15/Mar/2024:10:00:13 -0700] "DELETE /api/v2/users/123 HTTP/1.1" 204 0 "/admin" "Mozilla/5.0"`,

  syslog:`Mar 15 10:00:01 web-01 sshd: Accepted publickey for alice from 192.168.1.10 port 51234
Mar 15 10:00:03 web-01 sudo: alice : TTY=pts/0 ; PWD=/home/alice ; USER=root ; COMMAND=/bin/systemctl restart nginx
Mar 15 10:00:05 db-01 kernel: Out of memory: Kill process 4521 (postgres) score 900
Mar 15 10:00:07 web-01 nginx: error: connect() failed (111: Connection refused) while connecting to upstream
Mar 15 10:00:09 fw-01 kernel: DROP IN=eth0 SRC=198.51.100.23 DST=10.0.0.5 PROTO=TCP DPT=22
Mar 15 10:00:11 web-01 cron: (root) CMD (/usr/sbin/logrotate /etc/logrotate.conf)
Mar 15 10:00:13 db-01 postgres: FATAL: password authentication failed for user admin
Mar 15 10:00:15 web-01 sshd: Failed password for root from 45.33.32.156 port 44321 ssh2
Mar 15 10:00:17 web-01 sshd: Failed password for root from 45.33.32.156 port 44322 ssh2
Mar 15 10:00:19 web-01 sshd: Failed password for root from 45.33.32.156 port 44323 ssh2
Mar 15 10:00:21 fw-01 kernel: DROP IN=eth0 SRC=45.33.32.156 DST=10.0.0.5 PROTO=TCP DPT=3306
Mar 15 10:00:23 web-01 nginx: info: client 192.168.1.45 request GET /api/v2/health 200`,
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function init(){
  buildParserBtns();
  document.getElementById('cust-pat').value = S.custPat;
  document.getElementById('cust-grp').value = S.custGrp;
})();

function buildParserBtns(){
  const wrap = document.getElementById('parser-btns');
  wrap.innerHTML = '';
  [['auto','âš¡ Auto-detect'],...PARSERS.map(p=>[p.id,p.badge+' '+p.name])].forEach(([id,label])=>{
    const b = document.createElement('button');
    b.className = 'btn btn-sm '+(id==='auto'?'btn-a':'btn-g');
    b.dataset.pid = id;
    b.textContent = label;
    b.onclick = ()=>selectParser(id);
    wrap.appendChild(b);
  });
}

function selectParser(id){
  S.parserId = id;
  document.querySelectorAll('#parser-btns .btn').forEach(b=>{
    b.className = 'btn btn-sm '+(b.dataset.pid===id?'btn-a':'btn-g');
  });
  document.getElementById('custom-panel').style.display = id==='custom'?'flex':'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TAB SWITCHING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(name){
  document.getElementById('tab-input').style.display   = name==='input'  ?'flex':'none';
  document.getElementById('tab-analyze').style.display = name==='analyze'?'flex':'none';
  document.querySelectorAll('.tablink').forEach(b=>b.classList.toggle('active',b.dataset.tab===name));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INPUT HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onLogInput(v){
  S.raw = v;
  const lines = v.split('\n').filter(l=>l.trim()).length;
  document.getElementById('line-count').textContent = v ? lines+' lines' : '';
  document.getElementById('clear-btn').style.display = v?'':'none';
  document.getElementById('err-box').style.display = 'none';
}

function loadSample(key){
  const ta = document.getElementById('log-inp');
  ta.value = SAMPLES[key];
  onLogInput(SAMPLES[key]);
  selectParser('auto');
}

function loadFile(input){
  const f = input.files[0]; if(!f)return;
  const r = new FileReader();
  r.onload = e=>{
    document.getElementById('log-inp').value = e.target.result;
    onLogInput(e.target.result);
  };
  r.readAsText(f);
  input.value='';
}

function clearLog(){
  document.getElementById('log-inp').value='';
  onLogInput('');
}

function showErr(msg){ const e=document.getElementById('err-box'); e.textContent='âš  '+msg; e.style.display=''; }
function hideErr(){ document.getElementById('err-box').style.display='none'; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARSE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function parseLog(){
  const raw = document.getElementById('log-inp').value.trim();
  if(!raw){showErr('No log data to parse.');return;}
  hideErr();

  // scan animation
  const bar=document.getElementById('scan-bar');
  bar.classList.remove('run'); void bar.offsetWidth; bar.classList.add('run');

  try{
    let parser;
    if(S.parserId==='auto'){
      parser = PARSERS.find(p=>p.id!=='custom'&&p.detect(raw)) || PARSERS[0];
    } else {
      parser = PARSERS.find(p=>p.id===S.parserId);
    }
    const opts = S.parserId==='custom'?{
      pattern:document.getElementById('cust-pat').value,
      groups:document.getElementById('cust-grp').value,
    }:{};

    const parsed = parser.parse(raw, opts);
    if(!parsed.length){showErr(`Parser "${parser.name}" matched 0 entries. Try a different parser or Custom Regex.`);return;}

    S.raw = raw;
    S.entries = parsed;
    S.parserUsed = parser;
    S.selId = null;
    S.levelFilter = new Set(parsed.map(e=>e.level));
    S.sourceFilter = new Set(parsed.map(e=>e.source));

    applyFilters();
    switchTab('analyze');
    buildSidebar();
    setView('stream');
    updateHeader();

  }catch(err){showErr('Parse error: '+err.message);}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILTERING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function applyFilters(){
  let out = S.entries.filter(e=>S.levelFilter.has(e.level)&&S.sourceFilter.has(e.source));
  const q = S.search.trim();
  if(q){
    if(S.searchMode==='regex'){
      try{const re=new RegExp(q,'i');out=out.filter(e=>re.test(e.raw));}catch(e){}
    } else {
      const ql=q.toLowerCase();
      out=out.filter(e=>e.raw.toLowerCase().includes(ql));
    }
  }
  S.filtered=out;
}

function resetLevelFilter(){ S.levelFilter=new Set(S.entries.map(e=>e.level)); buildSidebar(); filterChanged(); }
function resetSourceFilter(){ S.sourceFilter=new Set(S.entries.map(e=>e.source)); buildSidebar(); filterChanged(); }

function toggleLevel(l){
  S.levelFilter.has(l)?S.levelFilter.delete(l):S.levelFilter.add(l);
  document.querySelectorAll('#level-filters .fitem').forEach(el=>el.classList.toggle('off',!S.levelFilter.has(el.dataset.v)));
  filterChanged();
}
function toggleSource(s){
  S.sourceFilter.has(s)?S.sourceFilter.delete(s):S.sourceFilter.add(s);
  document.querySelectorAll('#source-filters .fitem').forEach(el=>el.classList.toggle('off',!S.sourceFilter.has(el.dataset.v)));
  filterChanged();
}
function filterChanged(){ applyFilters(); renderView(); updateHeader(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SEARCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onSearch(v){
  S.search=v;
  document.getElementById('srch-clear').style.display=v?'':'none';
  filterChanged();
}
function clearSearch(){
  S.search='';
  document.getElementById('srch-inp').value='';
  document.getElementById('srch-clear').style.display='none';
  filterChanged();
}
function toggleSearchMode(){
  S.searchMode=S.searchMode==='text'?'regex':'text';
  const btn=document.getElementById('srch-mode');
  btn.textContent=S.searchMode==='regex'?'.*':'Aa';
  btn.classList.toggle('regex',S.searchMode==='regex');
  document.getElementById('srch-inp').placeholder=S.searchMode==='regex'?'Regex filterâ€¦':'Full-text searchâ€¦';
  if(S.search)filterChanged();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setView(v){
  S.view=v;
  const names=['stream','dist','fields'];
  names.forEach(n=>{
    const el=document.getElementById(n+'-view');
    const on=n===v;
    if(n==='stream') el.style.display=on?'block':'none';
    else if(n==='dist') el.style.display=on?'flex':'none';
    else el.style.display=on?'block':'none';
    const btn=document.getElementById('vbtn-'+n);
    if(btn) btn.className='btn btn-sm '+(on?'btn-a':'btn-g');
  });
  renderView();
}

function renderView(){
  if(S.view==='stream') renderStream();
  else if(S.view==='dist') renderDist();
  else renderFields();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIDEBAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildSidebar(){
  const lvMap=new Map();
  S.entries.forEach(e=>lvMap.set(e.level,(lvMap.get(e.level)||0)+1));
  const lvSorted=[...lvMap].sort((a,b)=>(lvMeta(a[0]).rank||99)-(lvMeta(b[0]).rank||99));

  const lf=document.getElementById('level-filters');
  lf.innerHTML='';
  lvSorted.forEach(([l,cnt])=>{
    const meta=lvMeta(l);
    const d=document.createElement('div');
    d.className='fitem'+(S.levelFilter.has(l)?'':' off');
    d.dataset.v=l;
    d.onclick=()=>toggleLevel(l);
    d.innerHTML=`<div style="display:flex;align-items:center;gap:8px"><div class="fdot" style="background:${meta.color}"></div><span style="font-size:11px;font-weight:600;color:${meta.color}">${l}</span></div><span class="fcount">${cnt}</span>`;
    lf.appendChild(d);
  });

  const srcMap=new Map();
  S.entries.forEach(e=>srcMap.set(e.source,(srcMap.get(e.source)||0)+1));
  const srcSorted=[...srcMap].sort((a,b)=>b[1]-a[1]);

  const sf=document.getElementById('source-filters');
  sf.innerHTML='';
  srcSorted.forEach(([s,cnt])=>{
    const d=document.createElement('div');
    d.className='fitem'+(S.sourceFilter.has(s)?'':' off');
    d.dataset.v=s;
    d.onclick=()=>toggleSource(s);
    d.innerHTML=`<span style="font-size:11px;color:var(--t2);overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc(s)}</span><span class="fcount">${cnt}</span>`;
    sf.appendChild(d);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STREAM VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderStream(){
  const list=document.getElementById('stream-list');
  const empty=document.getElementById('stream-empty');
  const f=S.filtered;
  if(!f.length){ list.innerHTML=''; empty.style.display='flex'; return; }
  empty.style.display='none';

  const frag=document.createDocumentFragment();
  f.forEach(e=>{
    const meta=lvMeta(e.level);
    const c=`${meta.color}`;
    const div=document.createElement('div');
    div.className='lrow'+(S.selId===e.id?' sel':'');
    div.dataset.id=e.id;
    div.onclick=()=>selectEntry(e.id);
    div.innerHTML=
      `<span class="pill" style="background:${c}18;color:${c};border:1px solid ${c}33;min-width:60px;flex-shrink:0;margin-top:1px">${e.level}</span>`+
      (e.timestamp?`<span class="lts">${esc(e.timestamp)}</span>`:'')+
      `<span class="lsrc">${esc(e.source)}</span>`+
      `<span class="lmsg">${hlText(esc(e.message),S.search,S.searchMode)}</span>`;
    frag.appendChild(div);
  });
  list.innerHTML='';
  list.appendChild(frag);
}

function hlText(text,query,mode){
  if(!query)return text;
  try{
    const re=mode==='regex'
      ?new RegExp(`(${query})`,'gi')
      :new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`,'gi');
    return text.replace(re,'<mark>$1</mark>');
  }catch(e){return text;}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DETAIL PANEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function selectEntry(id){
  if(S.selId===id){
    S.selId=null;
    document.getElementById('detail-panel').style.display='none';
  } else {
    S.selId=id;
    const e=S.filtered.find(e=>e.id===id);
    if(e) renderDetail(e);
  }
  document.querySelectorAll('.lrow').forEach(el=>el.classList.toggle('sel',parseInt(el.dataset.id)===S.selId));
}

function closeDetail(){
  S.selId=null;
  document.getElementById('detail-panel').style.display='none';
  document.querySelectorAll('.lrow').forEach(el=>el.classList.remove('sel'));
}

function renderDetail(e){
  const meta=lvMeta(e.level);
  const c=meta.color;
  const panel=document.getElementById('detail-panel');
  panel.style.display='flex';
  panel.style.flexDirection='column';
  document.getElementById('detail-ttl').textContent='Entry #'+e.id;

  const skip=new Set(['message','msg','text','timestamp','time','ts','level','severity','service','source','logger','app','application','component']);
  const extras=Object.entries(e.fields||{}).filter(([k])=>!skip.has(k));
  const fieldsHtml=extras.length?`<div class="dfield"><span class="dlabel">Fields</span><div style="margin-top:4px">${extras.map(([k,v])=>`<div class="dkv"><span class="dkv-k">${esc(k)}</span><span class="dkv-v">${esc(String(v))}</span></div>`).join('')}</div></div>`:'';

  document.getElementById('detail-body').innerHTML=`
    <div class="dfield"><span class="dlabel">Severity</span><span class="pill" style="background:${c}18;color:${c};border:1px solid ${c}33">${e.level}</span></div>
    ${e.timestamp?`<div class="dfield"><span class="dlabel">Timestamp</span><div class="dval">${esc(e.timestamp)}</div></div>`:''}
    <div class="dfield"><span class="dlabel">Source</span><div class="dval" style="color:var(--cyan)">${esc(e.source)}</div></div>
    <div class="dfield"><span class="dlabel">Message</span><div class="dval">${esc(e.message)}</div></div>
    ${fieldsHtml}
    <div class="dfield"><span class="dlabel">Raw</span><pre class="raw-block">${esc(e.raw)}</pre></div>`;

}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DISTRIBUTION VIEW â€” pure inline SVG, zero deps
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDist(){
const container=document.getElementById(â€˜dist-viewâ€™);
container.innerHTML=â€™â€™;
const f=S.filtered;
if(!f.length){container.innerHTML=â€™<div class="empty"><div class="empty-icon">â—Œ</div><div>No data to visualize</div></div>â€™;return;}

const lvMap=new Map();
f.forEach(e=>lvMap.set(e.level,(lvMap.get(e.level)||0)+1));
const lvData=[â€¦lvMap].sort((a,b)=>(lvMeta(a[0]).rank||99)-(lvMeta(b[0]).rank||99));

const srcMap=new Map();
f.forEach(e=>srcMap.set(e.source,(srcMap.get(e.source)||0)+1));
const srcData=[â€¦srcMap].sort((a,b)=>b[1]-a[1]);

const errCnt=f.filter(e=>e.level===â€˜ERRORâ€™||e.level===â€˜CRITICALâ€™).length;
const warnCnt=f.filter(e=>e.level===â€˜WARNâ€™||e.level===â€˜WARNINGâ€™).length;
const errRate=f.length?((errCnt/f.length)*100).toFixed(1):â€˜0.0â€™;
const warnRate=f.length?((warnCnt/f.length)*100).toFixed(1):â€˜0.0â€™;

// Stat cards
const sg=document.createElement(â€˜divâ€™);
sg.className=â€˜stat-gridâ€™;
sg.innerHTML=statCard(â€˜Total Entriesâ€™,f.length.toLocaleString(),â€˜var(â€“blue)â€™,â€˜of â€˜+S.entries.length+â€™ totalâ€™)+
statCard(â€˜Error Rateâ€™,errRate+â€™%â€™,â€˜var(â€“red)â€™,â€˜ERROR + CRITICALâ€™)+
statCard(â€˜Warn Rateâ€™,warnRate+â€™%â€™,â€˜var(â€“orange)â€™,â€˜WARN level eventsâ€™);
container.appendChild(sg);

// Charts
const cr=document.createElement(â€˜divâ€™);
cr.className=â€˜chart-rowâ€™;
cr.appendChild(makeBarChart(â€˜Severity Distributionâ€™,lvData.map(([l,v])=>({label:l,value:v,color:lvMeta(l).color}))));
cr.appendChild(makePieChart(â€˜Source Breakdownâ€™,srcData.slice(0,8).map(([s,v],i)=>({label:s,value:v,color:COLORS[i%COLORS.length]}))));
container.appendChild(cr);

// Leaderboard
const lb=document.createElement(â€˜divâ€™);
lb.className=â€˜cardâ€™;
lb.innerHTML=â€™<div class="card-title">Source Volume Ranking</div>â€™+
srcData.map(([s,v],i)=>`<div class="src-row"> <span class="rank-num">#${i+1}</span> <span class="src-name" title="${esc(s)}">${esc(s)}</span> <div class="src-bar-bg"><div class="src-bar-fill" style="width:${(v/srcData[0][1]*100).toFixed(1)}%;background:${COLORS[i%COLORS.length]}"></div></div> <span class="src-cnt">${v}</span> </div>`).join(â€™â€™);
container.appendChild(lb);
}

function statCard(label,value,color,sub){
return`<div class="stat-card" style="border-top-color:${color}"><div class="stat-num" style="color:${color}">${value}</div><div class="stat-lbl">${label}</div>${sub?`<div class="stat-sub">${sub}</div>`:''}</div>`;
}

function makeBarChart(title, data){
const W=400,H=180,pL=36,pB=28,pT=10,pR=10;
const iW=W-pL-pR, iH=H-pT-pB;
const maxV=Math.max(â€¦data.map(d=>d.value),1);
const bW=Math.min(48,(iW/Math.max(data.length,1))-8);
const gap=iW/Math.max(data.length,1);
let ticks=â€™â€™,bars=â€™â€™;
for(let t=0;t<=4;t++){
const val=Math.round(maxV*t/4);
const y=pT+iH-(t/4)*iH;
ticks+=`<line x1="${pL}" x2="${W-pR}" y1="${y}" y2="${y}" stroke="#2d3542" stroke-width="1"/> <text x="${pL-4}" y="${y+4}" text-anchor="end" class="bar-label">${val}</text>`;
}
data.forEach((d,i)=>{
const bH=Math.max(2,(d.value/maxV)*iH);
const x=pL+gap*i+(gap-bW)/2;
const y=pT+iH-bH;
bars+=`<rect x="${x}" y="${y}" width="${bW}" height="${bH}" rx="3" fill="${d.color}" opacity=".9"/> <text x="${x+bW/2}" y="${pT+iH+16}" text-anchor="middle" class="bar-label">${d.label}</text> <text x="${x+bW/2}" y="${y-3}" text-anchor="middle" class="bar-val">${d.value}</text>`;
});
const div=document.createElement(â€˜divâ€™);
div.className=â€˜cardâ€™;
div.innerHTML=`<div class="card-title">${title}</div><svg viewBox="0 0 ${W} ${H}" style="width:100%;max-height:195px;overflow:visible">${ticks}${bars}<line x1="${pL}" x2="${pL}" y1="${pT}" y2="${pT+iH}" stroke="#2d3542" stroke-width="1"/></svg>`;
return div;
}

function makePieChart(title, data){
if(!data.length){const d=document.createElement(â€˜divâ€™);d.className=â€˜cardâ€™;d.innerHTML=`<div class="card-title">${title}</div>`;return d;}
const total=data.reduce((s,d)=>s+d.value,0);
const CX=100,CY=100,R=82,IR=46;
let slices=â€™â€™,angle=-Math.PI/2;
data.forEach(d=>{
const sw=(d.value/total)*Math.PI*2;
const x1=CX+R*Math.cos(angle),y1=CY+R*Math.sin(angle);
angle+=sw;
const x2=CX+R*Math.cos(angle),y2=CY+R*Math.sin(angle);
const xi1=CX+IR*Math.cos(angle-sw),yi1=CY+IR*Math.sin(angle-sw);
const xi2=CX+IR*Math.cos(angle),yi2=CY+IR*Math.sin(angle);
const lg=sw>Math.PI?1:0;
slices+=`<path d="M${xi1} ${yi1} L${x1} ${y1} A${R} ${R} 0 ${lg} 1 ${x2} ${y2} L${xi2} ${yi2} A${IR} ${IR} 0 ${lg} 0 ${xi1} ${yi1} Z" fill="${d.color}" opacity=".88"><title>${esc(d.label)}: ${d.value}</title></path>`;
});
const legend=data.map(d=>`<div class="pie-li"><div class="pie-dot" style="background:${d.color}"></div><span style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc(d.label)}</span><span style="color:var(--t3);flex-shrink:0;margin-left:4px">${((d.value/total)*100).toFixed(0)}%</span></div>`).join(â€™â€™);
const div=document.createElement(â€˜divâ€™);
div.className=â€˜cardâ€™;
div.innerHTML=`<div class="card-title">${title}</div><div style="display:flex;gap:14px;align-items:center"><svg viewBox="0 0 200 200" style="width:130px;flex-shrink:0">${slices}</svg><div class="pie-legend" style="flex:1;min-width:0">${legend}</div></div>`;
return div;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIELDS VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderFields(){
const f=S.filtered;
const skip=new Set([â€˜messageâ€™,â€˜msgâ€™,â€˜textâ€™,â€˜timestampâ€™,â€˜timeâ€™,â€˜tsâ€™,â€™@timestampâ€™,â€˜levelâ€™,â€˜severityâ€™,â€˜serviceâ€™,â€˜sourceâ€™,â€˜loggerâ€™,â€˜appâ€™,â€˜applicationâ€™,â€˜componentâ€™]);
const keySet=new Set();
f.slice(0,100).forEach(e=>Object.keys(e.fields||{}).forEach(k=>{if(!skip.has(k))keySet.add(k);}));
const extras=[â€¦keySet].slice(0,6);

document.getElementById(â€˜ftheadâ€™).innerHTML=`<tr><th>#</th><th>LEVEL</th><th>SOURCE</th><th>TIMESTAMP</th>${extras.map(k=>`<th style="color:var(--blue)">${esc(k)}</th>`).join('')}<th>MESSAGE</th></tr>`;

if(!f.length){document.getElementById(â€˜ftbodyâ€™).innerHTML=â€™<tr><td colspan="20" style="padding:40px;text-align:center;color:var(--t3)">No entries</td></tr>â€™;return;}

const frag=document.createDocumentFragment();
f.forEach(e=>{
const meta=lvMeta(e.level);const c=meta.color;
const tr=document.createElement(â€˜trâ€™);
tr.innerHTML=`<td class="td-id">${e.id}</td><td><span class="pill" style="background:${c}18;color:${c};border:1px solid ${c}33">${e.level}</span></td><td class="td-src">${esc(e.source)}</td><td class="td-ts">${esc(e.timestamp||'â€”')}</td>${extras.map(k=>`<td class="td-f">${esc(String(e.fields?.[k]??â€™â€”â€™))}</td>`).join('')}<td class="td-msg">${esc(e.message)}</td>`;
frag.appendChild(tr);
});
const tb=document.getElementById(â€˜ftbodyâ€™);
tb.innerHTML=â€™â€™;
tb.appendChild(frag);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HEADER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateHeader(){
if(S.parserUsed){
const b=document.getElementById(â€˜parser-badgeâ€™);
b.textContent=S.parserUsed.badge+â€™ â€˜+S.parserUsed.name;
b.style.display=â€™â€™;
}
if(S.entries.length){
const c=document.getElementById(â€˜entry-countâ€™);
c.innerHTML=`<b>${S.filtered.length.toLocaleString()}</b> / ${S.entries.length.toLocaleString()} entries`;
c.style.display=â€™â€™;
document.getElementById(â€˜btn-csvâ€™).style.display=â€™â€™;
document.getElementById(â€˜btn-jsonâ€™).style.display=â€™â€™;
}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportCSV(){
const keys=[â€˜idâ€™,â€˜timestampâ€™,â€˜levelâ€™,â€˜sourceâ€™,â€˜messageâ€™];
const rows=[keys.join(â€™,â€™),â€¦S.filtered.map(e=>keys.map(k=>JSON.stringify(String(e[k]||â€™â€™))).join(â€™,â€™))];
dl(rows.join(â€™\nâ€™),â€˜loglens-â€™+Date.now()+â€™.csvâ€™,â€˜text/csvâ€™);
}
function exportJSON(){
dl(JSON.stringify(S.filtered,null,2),â€˜loglens-â€™+Date.now()+â€™.jsonâ€™,â€˜application/jsonâ€™);
}
function dl(content,filename,type){
const a=document.createElement(â€˜aâ€™);
a.href=URL.createObjectURL(new Blob([content],{type}));
a.download=filename; a.click();
setTimeout(()=>URL.revokeObjectURL(a.href),1000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ESCAPE HTML
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function esc(s){
if(s==null)returnâ€™â€™;
return String(s).replace(/&/g,â€™&â€™).replace(/</g,â€™<â€™).replace(/>/g,â€™>â€™).replace(/â€/g,â€™"â€™);
}
</script>

</body>
</html>